<!doctype html>
<html lang="de">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{{ app_title }} ¬∑ Arbeitspaket</title>
    <link rel="icon" href="/static/favicon.svg" type="image/svg+xml" />
    <link rel="stylesheet" href="/static/app.css" />
  </head>
  <body>
    <header class="topbar">
      <div class="brand">
        <div class="logo">üéØ</div>
        <div>
          <div class="title">Goals</div>
          <div class="subtitle">Details ¬∑ {{ goal.title }}</div>
        </div>
      </div>
    </header>

    <main class="layout single">
      <section class="content">
        <section class="card">
          <div class="row">
            <h2>Arbeitspaket</h2>
            <a class="link" href="/?goal={{ goal.id }}">‚Üê zur√ºck zum Ziel</a>
          </div>

          <div class="muted">Aufgabe: {{ task_title }}</div>

          <form method="post" action="/goals/{{ goal.id }}/packages/{{ wp.id }}" class="stack" style="margin-top:12px">
            <label class="label">Titel</label>
            <input name="title" value="{{ wp.title }}" />

            <label class="label">Notizen (dein Kontext, Stolpersteine, Definition of Done)</label>
            <textarea name="notes" placeholder="Was ist hier genau zu tun?">{{ wp.notes }}</textarea>

            {% set d = (wp.notes | wp_details(wp.title)) %}
            <div class="card" style="padding:12px">
              <div class="muted" style="margin-bottom:8px; font-weight:900">Vorschau (strukturierte Details)</div>

              {% if d.summary %}
                <div class="wp-section">
                  <div class="wp-h">Kurzfassung</div>
                  <div class="muted" style="white-space: pre-wrap">{{ d.summary }}</div>
                </div>
              {% endif %}

              {% if d.steps and d.steps|length > 0 %}
                <div class="wp-section">
                  <div class="wp-h">Ablauf</div>
                  <ol class="wp-ol">
                    {% for s in d.steps %}
                      <li>{{ s }}</li>
                    {% endfor %}
                  </ol>
                </div>
              {% endif %}

              {% if d.checklist and d.checklist|length > 0 %}
                <div class="wp-section">
                  <div class="wp-h">Definition of Done</div>
                  <div class="wp-checklist">
                    {% for c in d.checklist %}
                      <label class="wp-check">
                        <input type="checkbox" disabled {% if c.done %}checked{% endif %} />
                        <span>{{ c.text }}</span>
                      </label>
                    {% endfor %}
                  </div>
                </div>
              {% endif %}

              {% if d.risks and d.risks|length > 0 %}
                <div class="wp-section">
                  <div class="wp-h">Risiken</div>
                  <ul class="wp-ul">
                    {% for r in d.risks %}
                      <li>{{ r }}</li>
                    {% endfor %}
                  </ul>
                </div>
              {% endif %}

              {% if d.sources and d.sources|length > 0 %}
                <div class="wp-section">
                  <div class="wp-h">Quellen</div>
                  <ul class="wp-ul">
                    {% for u in d.sources %}
                      <li><a class="link" href="{{ u }}" target="_blank" rel="noopener noreferrer">{{ u }}</a></li>
                    {% endfor %}
                  </ul>
                </div>
              {% endif %}
            </div>

            <div class="grid2">
              <div>
                <label class="label">L√§nge (Aufwand)</label>
                <input name="length" type="number" min="1" max="50" value="{{ wp.length }}" />
              </div>
              <div>
                <label class="label">Steigung (0‚Äì10)</label>
                <input name="grade" type="number" min="0" max="10" value="{{ wp.grade }}" />
              </div>
            </div>

            <label class="label">Status</label>
            <select name="status" class="select">
              <option value="todo" {% if wp.status.value == 'todo' %}selected{% endif %}>offen</option>
              <option value="done" {% if wp.status.value == 'done' %}selected{% endif %}>erledigt</option>
              <option value="diverted" {% if wp.status.value == 'diverted' %}selected{% endif %}>umgeleitet (Weiche)</option>
            </select>

            <div class="row" style="margin-top:6px">
              <button type="submit">Speichern</button>
              <div class="muted">Persistenz: {{ persistence }}</div>
            </div>
          </form>
        </section>
      </section>
    </main>

    {% include "debug_console.html" %}
  </body>
</html>
